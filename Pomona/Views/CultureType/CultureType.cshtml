@{
    Layout = null;
}

@{ await Html.RenderPartialAsync("PopupMessage"); }
@{ await Html.RenderPartialAsync("PopupMessageYesNo"); }

@using (Html.BeginForm())
{
    @(Html.DevExtreme().DataGrid<Pomona.Models.CultureType>
    ()
    .ID("cultureTypeGrid")
    .ShowBorders(true)
    .ElementAttr("overflow", "auto")
    .ShowColumnHeaders(true)
    .Sorting(sorting => sorting.Mode(GridSortingMode.Multiple))
    .ColumnMinWidth(50)
    .ColumnResizingMode(ColumnResizingMode.Widget)
    .DataSource(d => d.Mvc().Controller("CultureType")
    .LoadAction("GetCultureTypes")
    .InsertAction("InsertCultureType")
    .UpdateAction("UpdateCultureType")
    .DeleteAction("DeleteCultureType")
    .Key("CultureTypeId"))
    .Columns(columns =>
    {

        columns.AddFor(u => u.CultureTypeName).Option("required", true).Caption("Sorta voća");
        
        columns.AddFor(m => m.CultureId).Caption("Vrsta voća")
       //.FilterOperations(IEnumerable<GridFilterOperations>  GridFilterOperations.Contains )
    //    .FilterOperations(new[] { FilterOperations.Contains })
       // .CalculateFilterExpression("CalculateFilterExpressionCT")
        .MinWidth(600)
        .Lookup(lookup => lookup
        .DataSource(d => d.Mvc().Controller("Culture").LoadAction("GetCulturesStaticList").Key("CultureId"))
        .DisplayExpr("CultureName").Option("dx-placeholder", "test")
        .ValueExpr("CultureId"));

        columns.Add()
            .Type(GridCommandColumnType.Buttons)
            .Width(120)
            .Buttons(b =>
            {
                b.Add().Name(GridColumnButtonName.Edit);

                b.Add()
                .Hint("delete")
                .Icon("trash")
                .OnClick("onPrepareDeleteCultureType");
            });
    })
    .Editing(editing =>
    {
        editing.Mode(GridEditMode.Row);
        editing.AllowAdding(true);
        editing.ConfirmDelete(false);
        editing.AllowUpdating(true);
    })
      .Paging(p => p.PageSize(10))
      .Pager(pager =>
      {
          pager.ShowPageSizeSelector(true);
          pager.AllowedPageSizes(new[] { 10, 50, 100 });
      })
      .Summary(s => s
      .TotalItems(totalItems =>
      {
          totalItems.Add()
                 .Column("CultureTypeName")
                 .Name("CultureTypeSummary")
                 .SummaryType(SummaryType.Sum).DisplayFormat("Broj redova: " + ": {0}")
                 .CustomizeText("CultureTypeCountPerPage");
      })
       )
    .FilterRow(f => f.Visible(true))
    .HeaderFilter(f => f.Visible(true))
    .FocusedRowEnabled(true)
    .OnRowInserting("onRowInsertingCultureTypes")
    .OnRowUpdating("onRowUpdatingCultureTypes")
    .OnToolbarPreparing("onToolbarPreparingCultureTypes")
    // .OnFocusedRowChanged("OnFocusedRowChangedCultureTypes")
     .OnEditorPreparing("onCultureTypesGridEditorPreparing")
    )
    }

@{
    Layout = null;
}

@{ await Html.RenderPartialAsync("PopupMessage"); }
@{ await Html.RenderPartialAsync("PopupMessageYesNo"); }

@using (Html.BeginForm())
{

    @*@(Html.DevExtreme().Button().ID("yesPopupButton1").Option("HorizontalAlignment", "Center")
                                        .Icon("add")
                                        .OnClick("addPlotRowsClick")
                                )*@

    @(Html.DevExtreme().DataGrid<Pomona.Models.Plot>()
                                          .ID("plotGrid")
                                          .ShowBorders(true)
                                           .ElementAttr("overflow", "auto")
                                          .ShowColumnHeaders(true)
                                          // .AllowColumnResizing(true)
                                          .ColumnMinWidth(50)
                                          .ColumnResizingMode(ColumnResizingMode.Widget)
                                          .DataSource(d => d.Mvc().Controller("Plot")
                                          .LoadAction("GetPlots")
                                          .InsertAction("InsertPlot")
                                          .UpdateAction("UpdatePlot")
                                          .DeleteAction("DeletePlot")
                                          .Key("PlotId"))
                                          .Columns(columns =>
                                          {

                                              columns.AddFor(m => m.PlotListId).Caption("Parcela").AllowEditing(false)
                                              .MinWidth(600)
                                              .Lookup(lookup => lookup
                                              .DataSource(d => d.Mvc().Controller("Plot").LoadAction("GetPlotList").Key("PlotListId"))
                                              .DisplayExpr("PlotListName").Option("dx-placeholder", "test")
                                              .ValueExpr("PlotListId"));


                                              columns.AddFor(u => u.PlotLabel).Caption("Red").MinWidth(600);
                                              columns.Add()
                                               .Type(GridCommandColumnType.Buttons)
                                               .Width(120)
                                               .Buttons(b =>
                                               {
                                                   b.Add().Name(GridColumnButtonName.Edit);

                                                   b.Add()
                                                   .Hint("delete")
                                                   .Icon("trash")
                                                   .OnClick("onPrepareDeletePlot");
                                               });
                                          })
                                          .Editing(editing =>
                                          {
                                              editing.Mode(GridEditMode.Row);
                                              editing.AllowAdding(true);
                                              editing.ConfirmDelete(false);
                                              editing.AllowUpdating(true);
                                          })
                                        .Paging(p => p.PageSize(10))
                                        .Pager(pager =>
                                        {
                                            pager.ShowPageSizeSelector(true);
                                            pager.AllowedPageSizes(new[] { 10, 50, 100 });
                                        })
                                        .Summary(s => s
                                        .TotalItems(totalItems =>
                                        {
                                            totalItems.Add()
                                                   .Column("PlotListId")
                                                   .Name("PlotSummary")
                                                   .SummaryType(SummaryType.Sum).DisplayFormat("Broj redova: " + ": {0}")
                                                   .CustomizeText("PlotCountPerPage");               
                                        })
                                        )
                                        .FilterRow(f => f.Visible(true))
                                        .HeaderFilter(f => f.Visible(true))
                                        .FocusedRowEnabled(true)
                                        .OnRowInserting("onRowInsertingPlot")
                                        .OnRowUpdating("onRowUpdatingPlot")
                                        .OnToolbarPreparing("onToolbarPreparingPlot")
                                         // .OnFocusedRowChanged("OnFocusedRowChangedPlots")
                                          .OnEditorPreparing("OnEditorPreparingPlot")
                                         )





}